create  database abc
use abc

select*from product
select*from fact
select*from location

-- 1. Display the number of states present in the Location table.
SELECT COUNT(DISTINCT State) AS NumberOfStates FROM Location

-- 2. How many products are of regular type?
SELECT COUNT(*) AS RegularProductCount FROM Product WHERE Type = 'Regular'

-- 3. How much spending has been done on marketing of product ID 1?
SELECT SUM(Marketing) AS TotalMarketingSpent FROM fact WHERE ProductId = 1

-- 4. What is the minimum sales of a product?
SELECT MIN(Sales) AS MinSales FROM fact

-- 5. Display the max Cost of Goods Sold (COGS).
SELECT MAX(COGS) AS MaxCOGS FROM fact

-- 6. Display the details of the product where product type is coffee.
SELECT * FROM Product WHERE  product_Type = 'Coffee'


-- 7. Display the details where total expenses are greater than 40.
SELECT * FROM fact WHERE Total Expenses > 40

-- 8. What is the average sales in area code 719?
SELECT AVG(Sales) AS AvgSales FROM fact WHERE Area_Code = 719

-- 9. Find out the total profit generated by Colorado state.
SELECT SUM(f.Profit) AS TotalProfit
FROM fact f
JOIN Location l ON f.Area_Code = l.Area_Code
WHERE l.State = 'Colorado'

10. Display the average inventory for each product ID
select  avg(inventory) as avg_inventory from fact group by  productid 
select*from fact
select*from product
select*from location


 11. Display state in a sequential order in a Location Table.
select state from location order by  state
 12. Display the average budget of the Product where the average budget
margin should be greater than 100.
select avg(budget_sales) from fact having  avg(budget_margin) >100

13. What is the total sales done on date 2010-01-01?
select sum(sales) from fact where date = '2010-01-01'
14. Display the average total expense of each product ID on an individual date.
select avg(total_expenses) as [avg of total expenses on each date and each productid]
from fact group by productid ,date order by date asc

15. Display the table with the following attributes such as date, productID,
product_type, product, sales, profit, state, area_code.
select f.date , f.productid , p.product_type , p.product , f.sales , f.profit , l.state , f.area_code
from fact f 
join product p 
on 
f.productid = p.productid
join location l
on
f.area_code = l.area_code 

16. Display the rank without any gap to show the sales wise rank.
select * , ROW_NUMBER() over(order by sales desc) as [sales wise rank] from fact
17. Find the state wise profit and sales.
SELECT l.state, SUM(f.profit) AS total_profit, SUM(f.sales) AS total_sales
FROM fact f
JOIN location l 
ON 
f.area_code = l.area_code
GROUP BY 
l.state
ORDER BY 
total_profit, total_sales;
select*from fact
select*from location
select*from product
18. Find the state wise profit and sales along with the productname.
SELECT l.state, SUM(f.profit) AS total_profit, SUM(f.sales) AS total_sales , p.product
FROM fact f
join product p
on 
f.ProductId = p.ProductId
JOIN location l 
ON 
f.area_code = l.area_code
GROUP BY 
l.state , p.Product
ORDER BY 
total_profit, total_sales
19. If there is an increase in sales of 5%, calculate the increasedsales.
select * , sales *1.05  as increased_5_sales from fact
20. Find the maximum profit along with the product ID and producttype.
select max(f.profit) as max_profit , f.productid , p.product_type 
from fact f
join product p
on 
f.ProductId = p.ProductId
group by f.ProductId , p.Product_Type
order by ProductId 

21. Create a stored procedure to fetch the result according to the product typefrom Product Table.
create procedure pr
as 
begin
select product_type from product
end

exec pr
22. Write a query by creating a condition in which if the total expenses is 
lessthan60 then it is a profit or else loss.
select *, p_l = 
case 
when total_expenses < 60 then 'profit'
else 'loss'
end
from fact
go
23. Give the total weekly sales value with the date and product IDdetails.
Useroll-up to pull the data in hierarchical order.
select datepart(week , date) as week_no , productid , date ,sum(sales) as total_sales 
from fact 
group by
rollup(datepart(week , date) , productid , date)
order by
week_no,productid , date

24. Apply union and intersection operator on the tables which consist of
attribute area code. 
SELECT area_code 
FROM fact
UNION
SELECT area_code 
FROM location 

SELECT area_code 
FROM fact
intersect
SELECT area_code 
FROM location

SELECT area_code 
FROM location
EXCEPT
SELECT area_code 
FROM fact
--25. Create a user-defined function for the product table to fetch a particular
--product type based upon the users preference.
create function fn(@type varchar(50))
returns table 
as 
	return
		(select * from Product where Product_Type = @type )

select * from fn('coffee')


	
26. Change the product type from coffee to tea where product IDis 1 and undo it.
begin transaction
update product set product_type = 'tea' where product_type = 'coffee'
select*from product
rollback transaction


27. Display the date, product ID and sales where total expenses are
between 100 to 200.
select date, productid , sales from fact where total_expenses between 100 and 200

28. Delete the records in the Product Table for regular type. 
begin transaction
delete from product
where type ='regular'
select*from product
rollback transaction

29. Display the ASCII value of the fifth character from the columnProduct.
SELECT ASCII(SUBSTRING(Product, 5, 1)) AS FifthCharacterASCII
FROM Product